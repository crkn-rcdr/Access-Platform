{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "/canvas.json",
  "title": "Canvas",
  "description": "The virtual representation of the space taken up by a page of a Manifest.",
  "$comment": "The file name adds `.logical` due to a temporary limitation in Kivik",
  "type": "object",
  "propertyNames": {
    "type": "string",
    "enum": [
      "id",
      "_id",
      "rev",
      "type",
      "public",
      "updateInternalmeta",
      "source",
      "master",
      "takedown",
      "orphan",
      "ocrPdf",
      "ocrType"
    ]
  },
  "allOf": [
    { "$ref": "/access.json" },
    {
      "properties": {
        "source": {
          "description": "Information about this canvas's preservation origin",
          "type": "object",
          "oneOf": [
            {
              "properties": {
                "from": {
                  "description": "Sourced from legacy Canadiana preservation",
                  "const": "cihm"
                },
                "path": { "$ref": "/util/file/legacyRepoPath.json" }
              },
              "required": ["from", "path"],
              "additionalProperties": false
            },
            {
              "properties": {
                "from": {
                  "description": "Sourced from CRKN Archivematica installation",
                  "const": "am"
                },
                "aipId": {
                  "description": "Archivematica AIP ID",
                  "type": "string"
                },
                "objId": {
                  "description": "Archivematica Object ID",
                  "type": "string"
                }
              },
              "required": ["from", "aipId", "objId"],
              "additionalProperties": false
            }
          ]
        },
        "master": {
          "$comment": "If path is not specified, a file should exist in the access object store at $id.$extension. We will be changing this property's name in a forthcoming migration.",
          "description": "Information about the image this canvas represents",
          "$ref": "/util/file/image.json"
        },
        "takedown": {
          "type": "string",
          "enum": ["copyright", "privacy"]
        },
        "ocrPdf": {
          "description": "Information about the derivative PDF generated by OCR.",
          "$comment": "If path is not specified, a file should exist in the access object store at $id.pdf",
          "$ref": "/util/file.json"
        },
        "ocrType": {
          "description": "The type of the OCR XML data associated with this canvas",
          "type": "string",
          "enum": ["alto", "txtmap"]
        },
        "orphan": {
          "description": "As time goes on or errors take place, some canvases may no longer be referenced by a manifest. These canvases may be marked as orphans by setting this flag.",
          "type": "boolean",
          "default": false
        }
      },
      "required": ["master", "source"]
    }
  ]
}
